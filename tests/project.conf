targets=dlfcn,errno,fnmatch,iconv,includes,inttypes,langinfo,math,mman,msg,netdb,ptrace,pwd,regex,resource,rt,select,setjmp,shm,signal,socket,ssp,start,stdarg,stdint,stdio,stdlib,string,time,tests.log,unistd,utsname
cppflags_force=-nostdinc -isystem ../include
cflags_force=-ffreestanding
cflags=-W -Wall -g -O2 -fPIE -fstack-protector
ldflags_force=-nostdlib -L$(OBJDIR)../src -Wl,-rpath,$(OBJDIR)../src -lc $(OBJDIR)../src/ssp/libssp.a $(OBJDIR)../src/start.o `$(CC) -print-libgcc-file-name`
ldflags=-pie -Wl,-z,relro -Wl,-z,now
dist=Makefile,clint.sh,cross.sh,tests.sh

#[clint.log]
#type=script
#script=./clint.sh -O CPPFLAGS="-d$$PWD/../include -I$$PWD/../include/dl -I$$PWD/../include/math -I$$PWD/../include/pthread -I$$PWD/../include/rt -I$$PWD/../include/socket -I$$PWD/../src/regex/pcre -I$$PWD/../src -DHAVE_CONFIG_H"
#depends=clint.sh

[dlfcn]
type=binary
cppflags=-isystem ../include/dl
sources=dlfcn.c

[dlfcn.c]
depends=$(OBJDIR)../src/dl/libdl.a,$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[errno]
type=binary
sources=errno.c

[errno.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[fnmatch]
type=binary
sources=fnmatch.c

[fnmatch.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[iconv]
type=binary
sources=iconv.c

[iconv.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[includes]
type=binary
cppflags=-isystem ../include/pthread -isystem ../include/rt
sources=includes.c

[includes.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[inttypes]
type=binary
sources=inttypes.c

[langinfo]
type=binary
sources=langinfo.c

[langinfo.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[math]
type=binary
cppflags=-isystem ../include/math
ldflags=$(OBJDIR)../src/math/libm.a
sources=math.c

[math.c]
depends=$(OBJDIR)../src/math/libm.a,$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[mman]
type=binary
sources=mman.c

[mman.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[msg]
type=binary
sources=msg.c

[msg.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[netdb]
type=binary
cppflags=-isystem ../include/socket
ldflags=$(OBJDIR)../src/socket/libsocket.a
sources=netdb.c

[netdb.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/socket/libsocket.a,$(OBJDIR)../src/start.o

[ptrace]
type=binary
sources=ptrace.c

[ptrace.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[pwd]
type=binary
sources=pwd.c

[pwd.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[regex]
type=binary
sources=regex.c
cppflags=-DHAVE_CONFIG_H
ldflags=$(OBJDIR)../src/regex/libpcre.a -rdynamic

[regex.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[resource]
type=binary
sources=resource.c

[resource.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[rt]
type=binary
sources=rt.c
cppflags=-isystem ../include/rt
ldflags=$(OBJDIR)../src/rt/librt.a

[rt.c]
depends=$(OBJDIR)../src/rt/librt.a,$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o
cppflags=-isystem ../include/rt

[select]
type=binary
sources=select.c

[select.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[setjmp]
type=binary
sources=setjmp.c

[setjmp.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[shm]
type=binary
sources=shm.c

[signal]
type=binary
sources=signal.c

[signal.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[socket]
type=binary
sources=socket.c
ldflags=$(OBJDIR)../src/socket/libsocket.a

[socket.c]
depends=$(OBJDIR)../src/socket/libsocket.a,$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o
cppflags=-isystem ../include/socket

[ssp]
type=binary
sources=ssp.c

[ssp.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[start]
type=binary
sources=start.c

[start.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[stdarg]
type=binary
sources=stdarg.c

[stdarg.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[stdint]
type=binary
sources=stdint.c

[stdint.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[stdio]
type=binary
sources=stdio.c

[stdio.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o,../src/stdio.c

[stdlib]
type=binary
sources=stdlib.c

[stdlib.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[string]
type=binary
sources=string.c

[string.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[time]
type=binary
sources=time.c

[time.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[tests.log]
type=script
script=./tests.sh
depends=$(OBJDIR)dlfcn,$(OBJDIR)errno,$(OBJDIR)fnmatch,$(OBJDIR)iconv,$(OBJDIR)includes,$(OBJDIR)inttypes,$(OBJDIR)langinfo,$(OBJDIR)math,$(OBJDIR)mman,$(OBJDIR)msg,$(OBJDIR)netdb,$(OBJDIR)ptrace,$(OBJDIR)pwd,$(OBJDIR)regex,$(OBJDIR)resource,$(OBJDIR)rt,$(OBJDIR)select,$(OBJDIR)setjmp,$(OBJDIR)shm,$(OBJDIR)signal,$(OBJDIR)socket,$(OBJDIR)ssp,$(OBJDIR)start,$(OBJDIR)stdarg,$(OBJDIR)stdint,$(OBJDIR)stdio,$(OBJDIR)stdlib,$(OBJDIR)string,$(OBJDIR)time,tests.sh,$(OBJDIR)unistd,$(OBJDIR)utsname

[unistd]
type=binary
sources=unistd.c

[unistd.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o

[utsname]
type=binary
sources=utsname.c

[utsname.c]
depends=$(OBJDIR)../src/libc.a,$(OBJDIR)../src/start.o
